<VirtualHost *:80>
    ServerAdmin sirexas@gmail.com
    ServerName {{ name }}
    RedirectMatch ^/(.*)$ https://{{ name }}/$1
    ErrorLog /var/log/apache2/{{ name }}/error.log
    CustomLog /var/log/apache2/{{ name }}/access.log combined
</VirtualHost>


<VirtualHost *:443>
    ServerAdmin sirexas@gmail.com
    ServerName {{ name }}

    DocumentRoot {{ path }}/static

    Alias /media/ {{ path }}/media/
    Alias /static/ {{ path }}/static/

    <Directory {{ path }}/media>
        Require all granted
        Options -Indexes
    </Directory>

    <Directory {{ path }}/static>
        Require all granted
        Options -Indexes
    </Directory>

    <Directory {{ path }}/project/>
        <Files wsgi.py>
            Require all granted
        </Files>
    </Directory>

    WSGIDaemonProcess {{ slug }} python-path={{ path }}:{{ home }}/venv/lib/python3.4/site-packages user={{ slug }} group=www-data processes=1 threads=4 display-name=wsgi-{{ slug }}
    WSGIProcessGroup {{ slug }}
    WSGIScriptAlias / {{ path }}/project/wsgi.py

    SSLEngine on
    SSLProtocol all -SSLv2
    SSLCipherSuite ALL:!ADH:!EXPORT:!SSLv2:RC4+RSA:+HIGH:+MEDIUM

    SSLCertificateFile {{ home }}/certs/ssl.crt
    SSLCertificateKeyFile {{ home }}/certs/ssl.key
    SSLCertificateChainFile {{ home }}/certs/sub.class1.server.ca.pem

    ErrorLog /var/log/apache2/{{ name }}/error.log
    CustomLog /var/log/apache2/{{ name }}/access.log combined
    CustomLog /var/log/apache2/{{ name }}/ssl.log "%t %h %{SSL_PROTOCOL}x %{SSL_CIPHER}x \"%r\" %b"
</VirtualHost>
